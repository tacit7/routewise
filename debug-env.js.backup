// Debug script to check environment variable loading
// Run this with: node debug-env.js

const { config } = require('dotenv');
const { resolve } = require('path');
const fs = require('fs');

console.log('üîç OAuth Environment Debug Script');
console.log('=====================================');

// Check current working directory
console.log('Current working directory:', process.cwd());

// Check if .env files exist
const envPaths = [
  resolve(process.cwd(), '.env'),
  resolve(process.cwd(), '..', '.env'),
];

envPaths.forEach(path => {
  console.log(`\nüìÅ Checking: ${path}`);
  
  if (fs.existsSync(path)) {
    console.log('‚úÖ File exists');
    
    // Try to read the file content
    try {
      const content = fs.readFileSync(path, 'utf8');
      const lines = content.split('\n');
      const googleLines = lines.filter(line => line.includes('GOOGLE_'));
      
      console.log('Google-related environment variables found:');
      googleLines.forEach(line => {
        if (line.trim() && !line.startsWith('#')) {
          const [key] = line.split('=');
          console.log(`  - ${key.trim()}`);
        }
      });
    } catch (error) {
      console.log('‚ùå Error reading file:', error.message);
    }
    
    // Try to load with dotenv
    try {
      const result = config({ path });
      if (result.error) {
        console.log('‚ùå Dotenv load error:', result.error.message);
      } else {
        console.log('‚úÖ Dotenv loaded successfully');
      }
    } catch (error) {
      console.log('‚ùå Dotenv load exception:', error.message);
    }
  } else {
    console.log('‚ùå File does not exist');
  }
});

// Check final environment variables
console.log('\nüîç Final Environment Variables:');
console.log('NODE_ENV:', process.env.NODE_ENV || 'undefined');
console.log('GOOGLE_CLIENT_ID exists:', !!process.env.GOOGLE_CLIENT_ID);
console.log('GOOGLE_CLIENT_SECRET exists:', !!process.env.GOOGLE_CLIENT_SECRET);
console.log('GOOGLE_REDIRECT_URI:', process.env.GOOGLE_REDIRECT_URI || 'undefined');

if (process.env.GOOGLE_CLIENT_ID) {
  console.log('GOOGLE_CLIENT_ID length:', process.env.GOOGLE_CLIENT_ID.length);
  console.log('GOOGLE_CLIENT_ID starts with:', process.env.GOOGLE_CLIENT_ID.substring(0, 10) + '...');
}

if (process.env.GOOGLE_CLIENT_SECRET) {
  console.log('GOOGLE_CLIENT_SECRET length:', process.env.GOOGLE_CLIENT_SECRET.length);
  console.log('GOOGLE_CLIENT_SECRET starts with:', process.env.GOOGLE_CLIENT_SECRET.substring(0, 10) + '...');
}

// Test OAuth configuration logic
const isConfigured = !!(process.env.GOOGLE_CLIENT_ID && process.env.GOOGLE_CLIENT_SECRET);
console.log('\nüéØ OAuth Configuration Status:', isConfigured ? '‚úÖ CONFIGURED' : '‚ùå NOT CONFIGURED');
